package com.velox.doc.cookbook.custom_landing;

import com.aralis.df.cache.CachePublisher;
import com.aralis.vm.ClientNotifier;
import com.aralis.vm.SessionState;
import com.caelo.application.ScreenFactory;

import java.time.LocalDate;
import java.time.LocalTime;
import java.time.ZoneOffset;
import java.util.List;
import java.util.Set;

// tag::DashboardScreenProvider[]
public class DashboardScreenProvider implements ScreenFactory<DashboardScreen> {
    @Override
    public DashboardScreen createScreen(SessionState state, ClientNotifier notifier, String name) {
        var md = state.getCachePublisherFactory().create(MarketDataTableDescriptor.Descriptor);
        var analytics = state.getCachePublisherFactory().create(MarketDataTableDescriptor.Descriptor);
        var hd = state.getCachePublisherFactory().create(HistoryDataTableDescriptor.Descriptor);
        var screen = new DashboardScreen(name, state, analytics.getTable(), md.getTable(), hd.getTable());

        /* Publish some mock data to CacheTables. */
        init(screen, md, hd, analytics);

        return screen;
    }
    // end::DashboardScreenProvider[]

    private void init(
      DashboardScreen screen,
      CachePublisher<MarketData, Object> md,
      CachePublisher<HistoryData, Object> hd,
      CachePublisher<MarketData, Object> analytics) {
        var activator = md.getTable().subscribeByKeys(analytics, screen.cancellationManager());
        activator.activate(Set.of("Dow Jones", "S&P 500", "Hang Seng", "DAX"));
        md.publish(List.of(
          MarketDataBuilder.newBuilder()
            .name("Dow Jones")
            .last(38868.04)
            .high(38877.86)
            .low(38665.45)
            .change(69.05)
            .changePercent(0.18)
            .time(LocalTime.parse("17:08:37").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("S&P 500")
            .last(5360.79)
            .high(5365.79)
            .low(5331.52)
            .change(13.80)
            .changePercent(0.26)
            .time(LocalTime.parse("17:08:37").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("Nasdaq")
            .last(17192.66)
            .high(17213.45)
            .low(17057.34)
            .change(59.53)
            .changePercent(0.35)
            .time(LocalTime.parse("15:59:55").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("Small Cap 2000")
            .last(2031.61)
            .high(2033.65)
            .low(2008.30)
            .change(5.06)
            .changePercent(0.25)
            .time(LocalTime.parse("01:00:00").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("S&P 500 VIX")
            .last(12.74)
            .high(12.74)
            .low(12.74)
            .change(0.00)
            .changePercent(0.00)
            .time(LocalTime.parse("00:00:17").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("S&P/TSX")
            .last(22069.76)
            .high(22105.69)
            .low(21953.44)
            .change(62.76)
            .changePercent(0.29)
            .time(LocalTime.parse("16:45:21").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("Bovespa")
            .last(120841)
            .high(121421)
            .low(120540)
            .change(74)
            .changePercent(0.06)
            .time(LocalTime.parse("15:59:30").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("S&P/BMV IPC")
            .last(53122.58)
            .high(53652.32)
            .low(52989.20)
            .change(145.26)
            .changePercent(0.27)
            .time(LocalTime.parse("16:26:00").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("MSCI World")
            .last(3482.42)
            .high(3484.10)
            .low(3481.80)
            .change(0.20)
            .changePercent(0.01)
            .time(LocalTime.parse("00:31:00").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("DAX")
            .last(18488.33)
            .high(18550.33)
            .low(18359.42)
            .change(-68.94)
            .changePercent(-0.37)
            .time(LocalTime.parse("11:38:59").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("FTSE 100")
            .last(8228.48)
            .high(8245.37)
            .low(8183.47)
            .change(-16.89)
            .changePercent(-0.20)
            .time(LocalTime.parse("11:35:00").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("CAC 40")
            .last(7893.98)
            .high(7893.98)
            .low(7812.52)
            .change(-107.82)
            .changePercent(-1.35)
            .time(LocalTime.parse("11:35:45").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("Euro Stoxx 50")
            .last(5015.55)
            .high(5015.55)
            .low(4971.65)
            .change(-35.76)
            .changePercent(-0.71)
            .time(LocalTime.parse("11:34:54").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("AEX")
            .last(924.70)
            .high(924.70)
            .low(917.76)
            .change(0.99)
            .changePercent(0.11)
            .time(LocalTime.parse("11:35:45").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("IBEX 35")
            .last(11357.20)
            .high(11375.30)
            .low(11286.90)
            .change(-47.70)
            .changePercent(-0.42)
            .time(LocalTime.parse("11:35:00").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("FTSE MIB")
            .last(34542.01)
            .high(34542.01)
            .low(34241.19)
            .change(-118.37)
            .changePercent(-0.34)
            .time(LocalTime.parse("11:35:00").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("SMI")
            .last(12128.01)
            .high(12202.93)
            .low(12096.55)
            .change(-126.75)
            .changePercent(-1.03)
            .time(LocalTime.parse("11:34:58").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("PSI")
            .last(6729.42)
            .high(6743.13)
            .low(6698.87)
            .change(-7.69)
            .changePercent(-0.11)
            .time(LocalTime.parse("11:35:45").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("BEL 20")
            .last(3887.80)
            .high(3888.30)
            .low(3859.00)
            .change(-15.50)
            .changePercent(-0.40)
            .time(LocalTime.parse("11:30:00").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("ATX")
            .last(3652.33)
            .high(3658.47)
            .low(3625.09)
            .change(-6.36)
            .changePercent(-0.17)
            .time(LocalTime.parse("11:50:00").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("OMXS30")
            .last(2600.72)
            .high(2612.26)
            .low(2587.36)
            .change(-22.87)
            .changePercent(-0.87)
            .time(LocalTime.parse("11:30:59").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("OMXC25")
            .last(2008.69)
            .high(2011.75)
            .low(1996.73)
            .change(-6.61)
            .changePercent(-0.33)
            .time(LocalTime.parse("11:00:00").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("MOEX")
            .last(3182.82)
            .high(3255.49)
            .low(3180.21)
            .change(-50.40)
            .changePercent(-1.56)
            .time(LocalTime.parse("11:40:00").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("RTSI")
            .last(1131.19)
            .high(1152.05)
            .low(1129.64)
            .change(-12.03)
            .changePercent(-1.05)
            .time(LocalTime.parse("11:40:00").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("WIG20")
            .last(2428.58)
            .high(2428.59)
            .low(2401.51)
            .change(-0.26)
            .changePercent(-0.01)
            .time(LocalTime.parse("11:15:00").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("Budapest SE")
            .last(70248.97)
            .high(70329.89)
            .low(69503.20)
            .change(369.54)
            .changePercent(0.53)
            .time(LocalTime.parse("01:00:00").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("BIST 100")
            .last(9997.91)
            .high(10142.95)
            .low(9986.94)
            .change(-141.06)
            .changePercent(-1.39)
            .time(LocalTime.parse("15:59:59").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("TA 35")
            .last(1978.63)
            .high(1980.84)
            .low(1961.49)
            .change(5.28)
            .changePercent(0.27)
            .time(LocalTime.parse("15:59:59").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("Tadawul All Share")
            .last(11853.82)
            .high(11954.20)
            .low(11835.18)
            .change(-1.29)
            .changePercent(-0.01)
            .time(LocalTime.parse("08:15:58").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("Nikkei 225")
            .last(39200.00)
            .high(39340.50)
            .low(39101.50)
            .change(145.50)
            .changePercent(0.37)
            .time(LocalTime.parse("00:31:35").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("S&P/ASX 200")
            .last(7755.30)
            .high(7860.00)
            .low(7735.10)
            .change(-104.70)
            .changePercent(-1.33)
            .time(LocalTime.parse("00:31:44").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("DJ New Zealand")
            .last(329.09)
            .high(330.27)
            .low(328.02)
            .change(-0.44)
            .changePercent(-0.13)
            .time(LocalTime.parse("00:31:51").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("Shanghai")
            .last(3017.73)
            .high(3043.20)
            .low(3013.86)
            .change(-33.55)
            .changePercent(-1.10)
            .time(LocalTime.parse("00:31:51").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("SZSE Component")
            .last(9212.75)
            .high(9231.71)
            .low(9166.47)
            .change(-42.93)
            .changePercent(-0.46)
            .time(LocalTime.parse("00:16:12").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("China A50")
            .last(12228.12)
            .high(12444.01)
            .low(12212.28)
            .change(-215.89)
            .changePercent(-1.73)
            .time(LocalTime.parse("23:30:00").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("Hang Seng")
            .last(18040.50)
            .high(18213.00)
            .low(17959.00)
            .change(-326.45)
            .changePercent(-1.78)
            .time(LocalTime.parse("00:31:35").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("SET")
            .last(1318.13)
            .high(1321.58)
            .low(1314.35)
            .change(-0.44)
            .changePercent(-0.03)
            .time(LocalTime.parse("00:16:00").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("KOSPI")
            .last(2709.68)
            .high(2718.88)
            .low(2702.17)
            .change(8.51)
            .changePercent(0.32)
            .time(LocalTime.parse("00:31:50").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("IDX Composite")
            .last(6909.76)
            .high(6932.46)
            .low(6876.97)
            .change(-11.79)
            .changePercent(-0.17)
            .time(LocalTime.parse("00:21:53").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("Nifty 50")
            .last(23285.60)
            .high(23290.00)
            .low(23206.65)
            .change(26.40)
            .changePercent(0.11)
            .time(LocalTime.parse("00:31:49").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("BSE Sensex")
            .last(76461.07)
            .high(76680.90)
            .low(76296.44)
            .change(-29.01)
            .changePercent(-0.04)
            .time(LocalTime.parse("00:16:51").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("PSEi Composite")
            .last(6458.34)
            .high(6464.26)
            .low(6444.94)
            .change(-0.30)
            .changePercent(0.00)
            .time(LocalTime.parse("00:16:00").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build(),
          MarketDataBuilder.newBuilder()
            .name("VN 30")
            .last(1305.92)
            .high(1318.09)
            .low(1305.66)
            .change(-5.18)
            .changePercent(-0.40)
            .time(LocalTime.parse("00:31:49").atDate(LocalDate.now()).toInstant(ZoneOffset.UTC))
            .build()));

        hd.publish(List.of(
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-31"))
            .price(5277.51)
            .open(5243.21)
            .high(5280.33)
            .low(5191.68)
            .changePercent(0.80)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-30"))
            .price(5235.48)
            .open(5259.77)
            .high(5260.21)
            .low(5222.10)
            .changePercent(-0.60)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-29"))
            .price(5266.95)
            .open(5278.73)
            .high(5282.27)
            .low(5262.70)
            .changePercent(-0.74)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-28"))
            .price(5306.04)
            .open(5315.91)
            .high(5315.91)
            .low(5280.89)
            .changePercent(0.02)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-24"))
            .price(5304.72)
            .open(5281.45)
            .high(5311.65)
            .low(5278.39)
            .changePercent(0.70)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-23"))
            .price(5267.84)
            .open(5340.26)
            .high(5341.88)
            .low(5256.93)
            .changePercent(-0.74)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-22"))
            .price(5307.01)
            .open(5319.28)
            .high(5323.18)
            .low(5286.01)
            .changePercent(-0.27)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-21"))
            .price(5321.41)
            .open(5298.69)
            .high(5324.32)
            .low(5297.87)
            .changePercent(0.25)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-20"))
            .price(5308.13)
            .open(5305.35)
            .high(5325.32)
            .low(5302.40)
            .changePercent(0.09)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-17"))
            .price(5303.27)
            .open(5303.10)
            .high(5305.45)
            .low(5283.59)
            .changePercent(0.12)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-16"))
            .price(5297.10)
            .open(5310.07)
            .high(5325.49)
            .low(5296.19)
            .changePercent(-0.21)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-15"))
            .price(5308.15)
            .open(5263.26)
            .high(5311.76)
            .low(5263.26)
            .changePercent(1.17)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-14"))
            .price(5246.68)
            .open(5221.10)
            .high(5250.37)
            .low(5217.98)
            .changePercent(0.48)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-13"))
            .price(5221.42)
            .open(5233.08)
            .high(5237.26)
            .low(5211.16)
            .changePercent(-0.02)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-10"))
            .price(5222.68)
            .open(5225.49)
            .high(5239.66)
            .low(5209.68)
            .changePercent(0.16)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-09"))
            .price(5214.08)
            .open(5189.03)
            .high(5215.30)
            .low(5180.41)
            .changePercent(0.51)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-08"))
            .price(5187.67)
            .open(5168.98)
            .high(5191.95)
            .low(5165.86)
            .changePercent(0.00)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-07"))
            .price(5187.70)
            .open(5187.20)
            .high(5200.23)
            .low(5178.96)
            .changePercent(0.13)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-06"))
            .price(5180.74)
            .open(5142.42)
            .high(5181.00)
            .low(5142.42)
            .changePercent(1.03)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-03"))
            .price(5127.79)
            .open(5122.78)
            .high(5139.12)
            .low(5101.22)
            .changePercent(1.26)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-02"))
            .price(5064.20)
            .open(5049.32)
            .high(5073.21)
            .low(5011.05)
            .changePercent(0.91)
            .build(),
          HistoryDataBuilder.newBuilder()
            .date(LocalDate.parse("2024-05-01"))
            .price(5018.39)
            .open(5029.03)
            .high(5096.12)
            .low(5013.45)
            .changePercent(-0.34)
            .build()));
    }
    // tag::DashboardScreenProvider[]
}
// end::DashboardScreenProvider[]